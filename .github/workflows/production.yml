name: production

on:
  push:
    branches:
      - main

jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v3
        with:
          ref: main

      - name: Install dependencies
        run: |
          yarn install --immutable
          yarn cypress install
        working-directory: tests

      - name: Run Cypress ðŸŒ²
        uses: cypress-io/github-action@v3
        with:
          working-directory: tests
          config-file: cypress.config.js
          command-prefix: yarn dlx
          install: false
        env:
          CYPRESS_BASE_URL: ${{ github.event.deployment_status.target_url }}
